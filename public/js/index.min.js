/*! pic-vote 2014-03-20 */
var app=angular.module("app",["infinite-scroll"]);app.controller("Imgs",["$scope","$http",function(a,b){a.imgs_data=window.imgs_data,a.vote=function(a,c,d){b.get("voteNum").success(function(d){if(d>=10)alert("你今天不能再投票");else if(confirm("确定要投这张图片?")){b.post("vote",$.param({imgs_id:c}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){"0"!==b?(alert("投票成功, 还有"+b+"次机会"),a.vote_count++):alert("投票失败")})}}),d.stopPropagation()},a.load=function(c){if(imgs_index<a.imgs_data.length){var d=a.imgs_data[imgs_index++];b.get("vote_count/"+d.id).success(function(b){d.vote_count=Number(b),a.imgs[c].push(d)})}};var c,d=3;for(a.imgs=new Array(d),c=0;d>c;++c)a.imgs[c]=[],a.load(c);for(c=0;d>c;++c)a.load(c);a.loadMore=function(b){a.load(b)}}]),$(function(){$(".fancybox").fancybox()});